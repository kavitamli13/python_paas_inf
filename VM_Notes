admusr@abg-demo-1:~$ helm install monitoring prometheus-community/kube-prometheus-stack \
  --namespace monitoring
NAME: monitoring
LAST DEPLOYED: Thu Dec 18 06:20:27 2025
NAMESPACE: monitoring
STATUS: deployed
REVISION: 1
DESCRIPTION: Install complete
NOTES:
kube-prometheus-stack has been installed. Check its status by running:
  kubectl --namespace monitoring get pods -l "release=monitoring"

Get Grafana 'admin' user password by running:

  kubectl --namespace monitoring get secrets monitoring-grafana -o jsonpath="{.data.admin-password}" | base64 -d ; echo

Access Grafana local instance:

  export POD_NAME=$(kubectl --namespace monitoring get pod -l "app.kubernetes.io/name=grafana,app.kubernetes.io/instance=monitoring" -oname)
  kubectl --namespace monitoring port-forward $POD_NAME 3000

Get your grafana admin user password by running:

  kubectl get secret --namespace monitoring -l app.kubernetes.io/component=admin-secret -o jsonpath="{.items[0].data.admin-password}" | base64 --decode ; echo


Visit https://github.com/prometheus-operator/kube-prometheus for instructions on how to create & configure Alertmanager and Prometheus instances using the Operator.





##########################################Prometheus Results#####################################################
kubectl exec -n monitoring deploy/monitoring-kube-prometheus-operator --   wget -qO- http://router.fission.svc.cluster.local:8080/metrics | grep fission_function
# HELP fission_function_calls_total Count of Fission function calls
# TYPE fission_function_calls_total counter
fission_function_calls_total{code="200",function_name="hellopy",function_namespace="admin-paas",method="GET",path=""} 1
fission_function_calls_total{code="200",function_name="hellopy",function_namespace="admin-paas",method="GET",path="/hellopy"} 2
fission_function_calls_total{code="200",function_name="hellopy",function_namespace="default",method="GET",path=""} 1
fission_function_calls_total{code="500",function_name="hellopy",function_namespace="admin-paas",method="GET",path=""} 1
# HELP fission_function_errors_total Count of Fission function errors
# TYPE fission_function_errors_total counter
fission_function_errors_total{code="500",function_name="hellopy",function_namespace="admin-paas",method="GET",path=""} 1
# HELP fission_function_overhead_seconds The function call delay caused by fission.
# TYPE fission_function_overhead_seconds summary
fission_function_overhead_seconds{code="200",function_name="hellopy",function_namespace="admin-paas",method="GET",path="",quantile="0.5"} NaN
fission_function_overhead_seconds{code="200",function_name="hellopy",function_namespace="admin-paas",method="GET",path="",quantile="0.9"} NaN
fission_function_overhead_seconds{code="200",function_name="hellopy",function_namespace="admin-paas",method="GET",path="",quantile="0.99"} NaN
fission_function_overhead_seconds_sum{code="200",function_name="hellopy",function_namespace="admin-paas",method="GET",path=""} 0.099163039
fission_function_overhead_seconds_count{code="200",function_name="hellopy",function_namespace="admin-paas",method="GET",path=""} 1
fission_function_overhead_seconds{code="200",function_name="hellopy",function_namespace="admin-paas",method="GET",path="/hellopy",quantile="0.5"} 0.006097636
fission_function_overhead_seconds{code="200",function_name="hellopy",function_namespace="admin-paas",method="GET",path="/hellopy",quantile="0.9"} 0.103352356
fission_function_overhead_seconds{code="200",function_name="hellopy",function_namespace="admin-paas",method="GET",path="/hellopy",quantile="0.99"} 0.103352356
fission_function_overhead_seconds_sum{code="200",function_name="hellopy",function_namespace="admin-paas",method="GET",path="/hellopy"} 0.10944999200000001
fission_function_overhead_seconds_count{code="200",function_name="hellopy",function_namespace="admin-paas",method="GET",path="/hellopy"} 2
fission_function_overhead_seconds{code="200",function_name="hellopy",function_namespace="default",method="GET",path="",quantile="0.5"} NaN
fission_function_overhead_seconds{code="200",function_name="hellopy",function_namespace="default",method="GET",path="",quantile="0.9"} NaN
fission_function_overhead_seconds{code="200",function_name="hellopy",function_namespace="default",method="GET",path="",quantile="0.99"} NaN
fission_function_overhead_seconds_sum{code="200",function_name="hellopy",function_namespace="default",method="GET",path=""} 0.109952727
fission_function_overhead_seconds_count{code="200",function_name="hellopy",function_namespace="default",method="GET",path=""} 1
fission_function_overhead_seconds{code="500",function_name="hellopy",function_namespace="admin-paas",method="GET",path="",quantile="0.5"} NaN
fission_function_overhead_seconds{code="500",function_name="hellopy",function_namespace="admin-paas",method="GET",path="",quantile="0.9"} NaN
fission_function_overhead_seconds{code="500",function_name="hellopy",function_namespace="admin-paas",method="GET",path="",quantile="0.99"} NaN
fission_function_overhead_seconds_sum{code="500",function_name="hellopy",function_namespace="admin-paas",method="GET",path=""} 60.005622502
fission_function_overhead_seconds_count{code="500",function_name="hellopy",function_namespace="admin-paas",method="GET",path=""} 1





###############################################################Fission-Prometheus Configuration############################################################################

Verify Fission services have labels:: 
Check router service:

kubectl get svc -n fission router -o yaml


If labels are missing, patch them (example):

kubectl label svc router -n fission app=fission-router

2️⃣ Create ServiceMonitor for Fission
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: fission-router
  namespace: monitoring
spec:
  namespaceSelector:
    matchNames:
      - fission
  selector:
    matchLabels:
      app: fission-router
  endpoints:
    - port: http
      path: /metrics
      interval: 30s


Do the same for:
executor
buildermgr
storagesvc

Note the application= Name in all the services/ Pods ensure the same name is provided in the yaml files 
{{{
  672  kubectl get svc -n fission router -o yaml
  674  kubectl label svc executor -n fission app=fission-executor
nano router_pr.yaml
  675  kubectl get svc -n fission executor -o yaml
  676  nano executor_pr.yaml
  678  kubectl get svc -n fission storagesvc -o yaml
  679  nano storage_pr.yaml
  680  nano builder_pr.yaml  // this is only for pod, since there is no service for buildermgr
  681  kubectl get deployments -n fission
  682  kubectl describe deployment/buildermgr -n fission
  684  kubectl apply -f router_pr.yaml
  686  kubectl apply -f executor_pr.yaml
  687  kubectl apply -f storage_pr.yaml
  688  kubectl apply -f builder_pr.yaml

}}}



3️⃣ Allow cross-namespace scraping

Ensure your Prometheus has:
kubectl edit prometheus monitoring-kube-prometheus-prometheus -n monitoring


serviceMonitorNamespaceSelector: {}
serviceMonitorSelector: {}

kubectl get prometheus monitoring-kube-prometheus-prometheus -n monitoring -o yaml | grep -q serviceMonitorNamespaceSelector && echo 'True' || echo 'False'
True
admusr@abg-demo-1:~$ kubectl get prometheus monitoring-kube-prometheus-prometheus -n monitoring -o yaml | grep -q serviceMonitorSelector && echo 'True' || echo 'False'
True




Verify metrics manually (sanity check)

From Prometheus pod:

kubectl exec -n monitoring deploy/prometheus -- \
  wget -qO- http://router.fission.svc.cluster.local:8080/metrics | fission_function


You should see metrics like:

fission_function_calls_total
fission_function_errors_total
fission_function_overhead_seconds
